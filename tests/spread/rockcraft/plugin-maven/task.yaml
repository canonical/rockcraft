summary: Maven plugin tests
execute: |
  SCENARIO="plugin-maven"
  ROCK_FILE="${SCENARIO}_0.1_amd64.rock"
  IMAGE="${SCENARIO}:0.1"

  # Build the rock & load it into docker
  run_rockcraft pack
  ls
  echo expecting ${ROCK_FILE}
  test -f ${ROCK_FILE}
  rockcraft.skopeo copy --insecure-policy  oci-archive:${ROCK_FILE} docker-daemon:${IMAGE}
  docker images
  rm ${ROCK_FILE}

  # Run the packaged project
  docker run --rm $IMAGE exec /usr/lib/jvm/java-21-openjdk-amd64/bin/java -jar /jar/sample-0.0.1-SNAPSHOT.jar | MATCH "hello world"

  docker system prune -a -f

  # Rebuild the java project
  touch sample/src/main/java/test/Test.java
  rockcraft pack
