name: plugin-maven
base: bare
build-base: ubuntu@24.04

version: '0.1'
summary: A rock that bundles a Maven project.
description: A rock that bundles a Maven project.
license: GPL-3.0
platforms:
  amd64:

parts:
  maven-sample:
    plugin: maven
    source: sample
    maven-parameters: [ "-B" ]
    stage-packages:
     - openjdk-21-jre-headless_core
     - base-files_base
    build-packages:
      - maven
      - openjdk-21-jdk-headless
    # replace chiselled image modules with jlink output
    # in order to ensure that only java.base module is present in
    # runtime
    override-build: |
      craftctl default
      rm -rf out
      jlink --no-header-files --no-man-pages --strip-debug \
        --add-modules java.base \
        --output out
      cp out/lib/modules ${CRAFT_PART_INSTALL}/usr/lib/jvm/java-21-openjdk-${CRAFT_ARCH_BUILD_FOR}/lib
