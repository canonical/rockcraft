name: internal-user
base: ubuntu@22.04
version: 'latest'
summary: Add an internal user inside a rock
description: Add an internal user inside a rock, and run a service with it.
platforms:
  amd64:

# [docs:rock-services]
services:
  web-service:
    override: replace
    command: node server.js
    startup: enabled
    on-success: shutdown
    on-failure: shutdown
    working-dir: /lib/node_modules/node_web_app
    user: myuser
# [docs:rock-services-end]

parts:
  my-part:
    plugin: npm
    npm-include-node: True
    npm-node-version: "21.1.0"
    source: src/
    stage-packages:
      - base-passwd_data
      - base-files_base
      - bash_bins
# [docs:rock-build]
    override-build: |
      craftctl default
      groupadd --root ${CRAFT_PART_INSTALL} mygroup
      useradd -d /home/myuser -s /bin/bash --root ${CRAFT_PART_INSTALL} -g mygroup myuser
# [docs:rock-build-end]
