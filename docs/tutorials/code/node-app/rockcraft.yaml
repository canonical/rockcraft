# [docs:rock-metadata]
name: my-node-app
base: ubuntu@22.04
version: '1.0'
summary: A ROCK that bundles a simple nodejs app
description: |
  This ROCK bundles a recent node runtime from nodesource.com
  to serve a simple "hello-world" app.
license: GPL-3.0
platforms:
  amd64:
# [docs:rock-metadata-end]

# [docs:pebble-service]
services:
    app:
        override: replace
        command: node server.js
        startup: enabled
        on-success: shutdown
        on-failure: shutdown
        working-dir: /app
# [docs:pebble-service-end]

# [docs:node-part]
parts:
    node:
        plugin: nil
        stage-packages: [nodejs]
# [docs:node-part-end]

# [docs:app-part]
    app:
        after: [node]
        plugin: nil
        source: src/
        override-build: |
          npm install
          cp -r * ${CRAFT_PART_INSTALL}/
        organize:
          "*": /app/
# [docs:app-part-end]

# [docs:nodesource-repo]
package-repositories:
  - type: apt
    url: https://deb.nodesource.com/node_21.x
    components: [main]
    suites: [nodistro]
    key-id: 6F71F525282841EEDAF851B42F59B5F99B1BE0B4
    priority: always
# [docs:nodesource-repo-end]
